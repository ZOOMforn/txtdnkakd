-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- AUTO-PUXAR OTIMIZADO - DELTA EXECUTOR
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")
local p = Players.LocalPlayer

-- ============================================
-- CONFIGURAÃ‡ÃƒO
-- ============================================
local ITENS_PERMITIDOS = {
    "AK47", "Planta Suja", "Planta Limpa", "Uzi", "PARAFAL",
    "Faca", "IA2", "G3", "IPhone 14", "Hi Power", "Glock 17",
    "Tratamento", "AR-15", "Lockpick", "Escudo", "C4",
    "PlÃ¡stico Vazio", "Usp"
}

local CONFIG = {
    DELAY_ENTRE_ITENS = 0.0016,          -- SEM DELAY (velocidade mÃ¡xima)
    INTERVALO_VERIFICACAO = 0.1,    -- VerificaÃ§Ã£o rÃ¡pida
    USAR_DELAYS_RANDOM = false,     -- Sem delays aleatÃ³rios
    MAX_RETENTATIVAS = 2,           -- Tentativas por item
}

-- ============================================
-- CACHE E VARIÃVEIS
-- ============================================
local ITENS_CACHE = {}
for _, item in ipairs(ITENS_PERMITIDOS) do
    ITENS_CACHE[item] = true
end

local executando = false
local conexoes = {}

-- ============================================
-- FUNÃ‡Ã•ES AUXILIARES
-- ============================================
local function delaySeguro(tempo)
    if CONFIG.USAR_DELAYS_RANDOM then
        local variacao = math.random(-20, 20) / 100
        tempo = tempo + (tempo * variacao)
    end
    task.wait(math.max(0.02, tempo))
end

local function encontrarInventario()
    for _, gui in pairs(p.PlayerGui:GetChildren()) do
        local inv = gui:FindFirstChild("Inventario", true)
        if inv then return inv end
    end
    return nil
end

local function notificar(msg)
    local notifyClient = RS:FindFirstChild("NotifyClient")
    if notifyClient then
        pcall(function() notifyClient:Fire(msg) end)
    end
end

-- ============================================
-- BUSCA INVENTÃRIO
-- ============================================
local Inventario = encontrarInventario()
local tentativas = 0

while not Inventario and tentativas < 50 do
    Inventario = encontrarInventario()
    tentativas = tentativas + 1
    task.wait(0.1)
end

if not Inventario then
    warn("[DELTA] âŒ InventÃ¡rio nÃ£o encontrado!")
    return
end

print("[DELTA] âœ“ InventÃ¡rio localizado")

local Selected = Inventario:WaitForChild("Selected")
local remote2 = RS:WaitForChild("Modules"):WaitForChild("InvRemotes"):WaitForChild("InvRequest")
local remote = RS:WaitForChild("Modules"):WaitForChild("InvRemotes"):WaitForChild("InvRemot")

-- ============================================
-- FUNÃ‡Ã•ES PRINCIPAIS
-- ============================================
local function transferirItem(nome, quantidade)
    for tentativa = 1, CONFIG.MAX_RETENTATIVAS do
        local success, result = pcall(function()
            return remote2:InvokeServer("mudaInv", "2", nome, quantidade)
        end)
        
        if success and result == "deubomkk" then
            return true
        end
        
        if tentativa < CONFIG.MAX_RETENTATIVAS then
            task.wait(0.05)
        end
    end
    
    return false
end

local function contarSlotsVazios()
    local conteudo = Inventario:FindFirstChild("MyInv")
    if not conteudo then return 0 end
    conteudo = conteudo:FindFirstChild("conteudo")
    if not conteudo then return 0 end
    
    local vazios = 0
    for _, slot in pairs(conteudo:GetChildren()) do
        if slot:IsA("TextLabel") and slot.Name:match("Slot") then
            if not slot.In:FindFirstChildWhichIsA("Frame") then
                vazios = vazios + 1
            end
        end
    end
    return vazios
end

local function verificarEPuxar()
    if executando then return end
    
    local outroInv = Inventario:FindFirstChild("Outro")
    if not outroInv or not outroInv.Visible then return end
    
    -- Ignora baÃºs
    local txtLabel = outroInv:FindFirstChild("TXT")
    if txtLabel then
        local texto = txtLabel.Text:upper()
        if texto:find("BAÃš") or texto:find("BAU") then return end
    end
    
    local conteudoOutro = outroInv:FindFirstChild("conteudo")
    if not conteudoOutro then return end
    
    -- Coleta itens
    local itensParaPuxar = {}
    for _, slot in pairs(conteudoOutro:GetChildren()) do
        if slot:IsA("TextLabel") and slot.Name:match("Slot") then
            local itemFrame = slot.In:FindFirstChildWhichIsA("Frame")
            if itemFrame and ITENS_CACHE[itemFrame.Name] then
                local qnt = 1
                local qntText = itemFrame:FindFirstChild("Qnt")
                if qntText then
                    qnt = tonumber(qntText.Text:match("%d+")) or 1
                end
                table.insert(itensParaPuxar, {nome = itemFrame.Name, qnt = qnt})
            end
        end
    end
    
    if #itensParaPuxar == 0 then return end
    
    executando = true
    
    -- Verifica espaÃ§o
    local slotsVazios = contarSlotsVazios()
    if slotsVazios < #itensParaPuxar then
        notificar("âš ï¸ InventÃ¡rio cheio!")
        executando = false
        return
    end
    
    -- Puxa itens
    local sucessos = 0
    local startTime = tick()
    
    for i, item in ipairs(itensParaPuxar) do
        if not outroInv.Visible then break end
        
        if transferirItem(item.nome, item.qnt) then
            sucessos = sucessos + 1
        end
        
        if i < #itensParaPuxar then
            delaySeguro(CONFIG.DELAY_ENTRE_ITENS)
        end
    end
    
    local tempoTotal = tick() - startTime
    
    if sucessos > 0 then
        notificar(string.format("âœ“ %d itens (%.1fs)", sucessos, tempoTotal))
        print(string.format("[DELTA] âœ“ Puxou %d itens em %.2fs", sucessos, tempoTotal))
    end
    
    executando = false
end

-- ============================================
-- SISTEMA DE LOOP
-- ============================================
local loopAtivo = true

task.spawn(function()
    print("[DELTA] ğŸ”„ Sistema ativado")
    
    while loopAtivo do
        local success, err = pcall(verificarEPuxar)
        if not success then
            warn("[DELTA] Erro:", err)
            executando = false
        end
        
        delaySeguro(CONFIG.INTERVALO_VERIFICACAO)
    end
end)

-- ============================================
-- EVENTOS
-- ============================================
local outroInv = Inventario:WaitForChild("Outro")

conexoes[#conexoes + 1] = outroInv:GetPropertyChangedSignal("Visible"):Connect(function()
    if outroInv.Visible then
        task.delay(0.1, verificarEPuxar)
    end
end)

conexoes[#conexoes + 1] = remote.OnClientEvent:Connect(function(w)
    if w == "revistUpToDate" then
        task.spawn(verificarEPuxar)
    end
end)

-- Cleanup ao morrer
conexoes[#conexoes + 1] = p.CharacterRemoving:Connect(function()
    loopAtivo = false
    for _, conn in pairs(conexoes) do
        conn:Disconnect()
    end
end)

print("[DELTA] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("[DELTA] âœ“ Sistema carregado")
print("[DELTA] âš¡ Delay: " .. CONFIG.DELAY_ENTRE_ITENS .. "s")
print("[DELTA] ğŸ” Itens: " .. #ITENS_PERMITIDOS)
print("[DELTA] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
